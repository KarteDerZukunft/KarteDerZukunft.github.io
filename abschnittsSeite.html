<!DOCTYPE html>
<html lang="de">
  <head>
    <!-- Basic -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Mobile Metas -->
    <meta
      name="viewport"
      content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <!-- Site Metas -->
    <title id="tabTitle"></title>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="author" content="AbuRadi" />

    <!-- Site Icons -->
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css" />

    <!-- OpenLayers CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.5.0/css/ol.css"
      type="text/css"
    />
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.5.0/build/ol.js"></script>

    <!-- <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
      crossorigin="anonymous"
    /> -->

    <!-- Site CSS -->
    <link rel="stylesheet" href="style.css" />
    <!-- Colors CSS -->

    <!-- ALL VERSION CSS -->
    <link rel="stylesheet" href="css/versions.css" />
    <!-- Responsive CSS -->
    <link rel="stylesheet" href="css/responsive.css" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/custom.css" />

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <!-- LOADER -->
    <div id="preloader">
      <div id="main-ld">
        <div id="loader"></div>
      </div>
    </div>
    <!-- END LOADER -->

    <!-- <div class="topbar text-center hidden-xs">
      <p>
        This site uses cookies. By continuing to browse "Ganz Sicher Berlin",
        you are agreeing to use our site cookies.
        <a href="#">Find out more here</a>
      </p>
    </div> -->

    <header class="header header_style_01">
      <nav class="megamenu navbar navbar-default">
        <div class="container">
          <div class="navbar-header">
            <button
              type="button"
              class="navbar-toggle collapsed"
              data-toggle="collapse"
              data-target="#navbar"
              aria-expanded="false"
              aria-controls="navbar"
            >
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html"
              ><img src="images/logos/logo.png" alt="image"
            /></a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
              <li>
                <a data-scroll-nav="1" href="./index.html">Wahlprojekt</a>
              </li>
              <li><a data-scroll-nav="2" href="#candidates">Kandidaten</a></li>
              <li><a data-scroll-nav="3" href="#themes">Themen</a></li>
              <li><a data-scroll-nav="4" href="#projekts">Projekte</a></li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <div id="topImgContainer"></div>

    <div class="customDivider">
      <svg
        data-name="Layer 1"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 1200 120"
        preserveAspectRatio="none"
      >
        <path
          d="M1200 120L0 16.48 0 0 1200 0 1200 120z"
          class="shape-fill"
        ></path>
      </svg>
    </div>

    <div id="textDetailsContainer">
      <h2 id="title">
        <!-- ${kdzObj.sections[i].title} [<a href="#" style="color: #ff392b">verlinkt</a>] -->
      </h2>
      <p id="description">
        <!-- ${kdzObj.sections[i].description} -->

        <br />
      </p>

      <br />

      <div class="kiezprojektContainer" id="kiezprojektContainer"></div>

      <br />

      <h2>Wo Wir Zu Finden Sind</h2>

      <br />

      <!-- The div element for the map -->
      <div class="mapContainer">
        <div id="map" class="map"></div>
        <div id="overlays" style="display: none">
          <!-- | -->
        </div>
      </div>

      <br />

      <h5 id="quickLinks"></h5>

      <script src="Data/kdz.js"></script>
      <script type="text/javascript">
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        let lon = 13.3789;
        let lat = 52.516396;

        var map = new ol.Map({
          target: "map",
          layers: [
            new ol.layer.Tile({
              source: new ol.source.OSM(),
            }),
          ],
          view: new ol.View({
            center: ol.proj.fromLonLat([lon, lat]),
            zoom: 18,
          }),
        });

        // adding the kiezprojekts

        const markers = [];

        for (let i = 0; i < kdzObj.places.length; i++) {
          if (
            kdzObj.places[i].type[0].slug === "kiezprojekt" &&
            kdzObj.places[i].coordinates !== ""
          ) {
            document.querySelector("#overlays").insertAdjacentHTML(
              "beforeend",
              `
                <a class="kpOverlay" id="kpOverlay${kdzObj.places[i].id}" target="_blank" href="kiezprojektSeite.html?kpid=${kdzObj.places[i].id}&cf=m">${kdzObj.places[i].title}</a>
                <div class="marker" id="marker${kdzObj.places[i].id}" title=""></div>
              `
            );

            var marker = new ol.Overlay({
              position: ol.proj.fromLonLat([
                kdzObj.places[i].coordinates.lng,
                kdzObj.places[i].coordinates.lat,
              ]),
              positioning: "center-center",
              element: document.getElementById(`marker${kdzObj.places[i].id}`),
              stopEvent: false,
            });

            map.addOverlay(marker);

            var kpOverlayX = new ol.Overlay({
              position: ol.proj.fromLonLat([
                kdzObj.places[i].coordinates.lng,
                kdzObj.places[i].coordinates.lat,
              ]),
              element: document.getElementById(
                `kpOverlay${kdzObj.places[i].id}`
              ),
            });

            map.addOverlay(kpOverlayX);

            markers.push([
              kdzObj.places[i].coordinates.lng,
              kdzObj.places[i].coordinates.lat,
            ]);
          } else if (kdzObj.places[i].coordinates !== "") {
            document.querySelector("#overlays").insertAdjacentHTML(
              "beforeend",
              `
                <div class="marker" id="marker${kdzObj.places[i].id}" title=""></div>
              `
            );

            var marker = new ol.Overlay({
              position: ol.proj.fromLonLat([
                kdzObj.places[i].coordinates.lng,
                kdzObj.places[i].coordinates.lat,
              ]),
              positioning: "center-center",
              element: document.getElementById(`marker${kdzObj.places[i].id}`),
              stopEvent: false,
            });

            map.addOverlay(marker);

            markers.push([
              kdzObj.places[i].coordinates.lng,
              kdzObj.places[i].coordinates.lat,
            ]);
          }
        }

        // asking users for their geolocation

        function getLocation() {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(assignPosition);
          }
        }

        function assignPosition(position) {
          lon = position.coords.longitude;
          lat = position.coords.latitude;

          map
            .getView()
            .setCenter(ol.proj.transform([lon, lat], "EPSG:4326", "EPSG:3857"));
        }

        getLocation();

        if (urlParams.has("sid")) {
          sid = urlParams.get("sid");

          for (let i = 0; i < kdzObj.sections.length; i++) {
            if (kdzObj.sections[i].id == sid) {
              if (kdzObj.sections[i].image.url !== "") {
                document
                  .querySelector("#topImgContainer")
                  .insertAdjacentHTML(
                    "beforeend",
                    `<img src="${kdzObj.sections[i].image.url}" />`
                  );
              } else {
                document
                  .querySelector("#topImgContainer")
                  .insertAdjacentHTML(
                    "beforeend",
                    `<img src="uploads/fallBack.jpeg" />`
                  );
              }

              document
                .querySelector("#title")
                .insertAdjacentHTML(
                  "beforeend",
                  `${kdzObj.sections[i].title} [<a href=\"themenabschnittListe.html?tid=${kdzObj.sections[i].belongs_to_topic}\" style=\"color: #ff392b\">verlinkt</a>]`
                );

              document
                .querySelector("#tabTitle")
                .insertAdjacentHTML("beforeend", `${kdzObj.sections[i].title}`);

              document
                .querySelector("#description")
                .insertAdjacentHTML(
                  "beforebegin",
                  `${kdzObj.sections[i].description}`
                );

              if (kdzObj.sections[i].tags !== "") {
                let tagsToInsert = "";

                for (let j = 0; j < kdzObj.sections[i].tags.length; j++) {
                  tagsToInsert += ` <a href="tagsListe.html?tag=${kdzObj.sections[i].tags[j].slug}">#${kdzObj.sections[i].tags[j].slug}</a>`;
                }

                document
                  .querySelector("#description")
                  .insertAdjacentHTML("beforeend", `${tagsToInsert}`);
              }
            }
          }

          // finding the associated topic

          for (let x = 0; x < kdzObj.sections.length; x++) {
            if (kdzObj.sections[x].id == sid) {
              tid = kdzObj.sections[x].belongs_to_topic;
              for (let p = 0; p < kdzObj.topics.length; p++) {
                if (kdzObj.topics[p].id == tid) {
                  tTitle = kdzObj.topics[p].title;
                }
              }
            }
          }

          // finding the associated cluster

          for (let y = 0; y < kdzObj.topics.length; y++) {
            if (kdzObj.topics[y].id == tid) {
              cid = kdzObj.topics[y].belongs_to_cluster;
              for (let p = 0; p < kdzObj.clusters.length; p++) {
                if (kdzObj.clusters[p].id == cid) {
                  cTitle = kdzObj.clusters[p].title;
                }
              }
            }
          }

          // listing the associated kiezprojekts

          let c = 5;
          let kiezprojektsToInsert = "";

          for (let j = 0; j < kdzObj.places.length; j++) {
            if (kdzObj.places[j].belongs_to_cluster == cid) {
              if (kdzObj.places[j].type[0].slug === "kiezprojekt") {
                kiezprojektsToInsert += `
                  <a href="kiezprojektSeite.html?kpid=${kdzObj.places[j].id}">${kdzObj.places[j].title}</a>
                  <br />`;
              }
              c--;
              if (c < 1) {
                break;
              }
            }
          }

          document
            .querySelector("#kiezprojektContainer")
            .insertAdjacentHTML("beforeend", `${kiezprojektsToInsert}`);

          document
            .querySelector("#quickLinks")
            .insertAdjacentHTML(
              "beforeend",
              `<a href="themenbereichListe.html?cid=${cid}">${cTitle}</a> | <a href="themenabschnittListe.html?tid=${tid}">${tTitle}</a>`
            );
        } else {
          window.location.replace("./404.html");
        }
      </script>
    </div>

    <div class="disclaimer" id="disclaimer">
      <a id="cancelBtn" onclick="return acknowledge()"> &#x2715; </a>

      <p>
        This site uses cookies. By continuing to browse KarteDerZukunft, you are
        agreeing to use <a href="#">our site cookies</a>.
      </p>
    </div>

    <script>
      acknowledged = localStorage.getItem("acknowledged");

      if (acknowledged == 1) {
        var disclaimer = document.getElementById("disclaimer");

        disclaimer.style.display = "none";
      }

      function acknowledge() {
        var disclaimer = document.getElementById("disclaimer");

        disclaimer.style.display = "none";

        acknowledged = 1;

        localStorage.setItem("acknowledged", acknowledged);
      }
    </script>

    <a href="#" id="scroll-to-top" class="dmtop global-radius"
      ><i class="fa fa-angle-up"></i
    ></a>

    <!-- ALL JS FILES -->
    <script src="js/all.js"></script>
    <!-- Camera Slider -->
    <script src="js/jquery.mobile.customized.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/scrollIt.min.js"></script>
    <!-- ALL PLUGINS -->
    <script src="js/custom.js"></script>
  </body>
</html>
